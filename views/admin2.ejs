 <body class="bg-light">
<div class="container py-5">

  <div class="d-flex justify-content-between mb-4">
    <h2>Admin Panel - Users</h2>
    <button class="btn btn-primary btn-sm" onclick="showAddRow()">+ Add User</button>
  </div>


  <div class="card mb-3">
    <div class="card-body">
      <div class="row">
        <div class="col-md-8">
          <input type="text" id="searchInput" class="form-control" placeholder="search by fields" onkeyup="searchTable()">
        </div>
        <div class="col-md-4">
          <select id="searchFilter" class="form-select" onchange="searchTable()">
            <option value="all">All fields</option>
            <option value="name">Name</option>
            <option value="email">Email</option>
            <option value="score">Score</option>
          </select>
        </div>
      </div>
      <small class="text-muted d-block mt-2">
        Found: <span id="resultCount">0</span>user(s)
      </small>
    </div>
  </div>

  <form id="addForm" class="mb-3 d-none" action="/admin/add" method="POST">
    <table class="table table-bordered">
      <tr>
        <td><input name="name" class="form-control form-control-sm" placeholder="Name"   /></td>
        <td><input name="email" class="form-control form-control-sm" placeholder="Email" type="email" /></td>
        <td><input name="password" class="form-control form-control-sm" placeholder="Password" type="password" /></td>
        <td><input name="score" class="form-control form-control-sm" type="number" placeholder="0" /></td>
        <td><button type="submit" class="btn btn-success btn-sm">Save</button></td>
      </tr>
    </table>
  </form>

  <table class="table table-striped">
    <thead class="table-light">
      <tr>
        <th>Name</th>
        <th>Email</th>
        <th>Score</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="tableBody">
        <% users.forEach((user)=>{ %>
            
                <tr id="row-<%= user._id %>" class="user-row" data-name="<%=user.name%>" data-email="<%= user.email %>" data-score="<%= user.score %>">
                    <td>
                        <input type="text" name="name" class="form-control form-control-sm user-name" value="<%=user.name%>" readonly>
                        </td>
                    <td>
                        <input type="text" name="email" class="form-control form-control-sm user-email" value="<%=user.email%>" readonly>
                        </td>
                    <td>
                        <input type="number" name="score" class="form-control form-control-sm user-score" value="<%=user.score%>" readonly>
                        </td>
                    <td> 
                        <div class="d-flex gap-2">
                            <!-- <button type="button" class="btn btn-warning btn-sm" onclick="editEnable('<%=user._id%>')">Edit</button>
                            <button type="submit" class="btn btn-primary btn-sm d-none" id="saveBtn-<%=user._id%>">Save</button> -->
                           
                           
                            <a href="/admin/edit/<%=user._id%>"  class="btn btn-warning btn-sm" >Edit</a>
<!--          
                            <form action="/admin/delete/<%=user._id%>?_method=DELETE" method="POST"></form> -->

                            <form action="/admin/delete/<%=user._id%>?_method=DELETE" method="POST" style="display: inline; margin: 0;">
                                <input type="hidden" name="_method" value="DELETE"> 
                                
                                <button type="submit" class="btn btn-danger btn-sm" 
                                        onclick="return confirm('Are you sure you want to delete this user?')">
                                    Delete
                                </button>
                            </form>

                            <!-- <a href="/admin/delete/<%=user._id%>?_method=DELETE" class="btn btn-danger btn-sm" 
                                onclick="return confirm('Are you sure you want to delete the user?')">Delete</a>
                            </div> -->
                          </td>
                </tr>
             
       <% }) %>
    </tbody>


 <!-- <tbody>
  <% users.forEach(user => { %>
    <tr id="row-<%= user._id %>">
      <td>
        <input type="text" name="name" class="form-control form-control-sm" value="<%= user.name %>" readonly />
      </td>
      <td>
        <input type="email" name="email" class="form-control form-control-sm" value="<%= user.email %>" readonly />
      </td>
      <td>
        <input type="number" name="score" class="form-control form-control-sm" value="<%= user.score %>" readonly />
      </td>
      <td> 
        <form id="form-<%= user._id %>" action="/admin/edit/<%= user._id %>" method="POST" class="d-flex gap-2">
          <button type="button" class="btn btn-warning btn-sm" onclick="editEnable('<%= user._id %>')">Edit</button>
          <button type="submit" class="btn btn-primary btn-sm d-none" id="saveBtn-<%= user._id %>">Save</button>
          <a href="/admin/delete/<%= user._id %>" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure?')">Delete</a>
        </form>
      </td>
    </tr>
  <% }) %>
</tbody> -->

 

  </table>
  <div class="alert alert-info d-none" id="noResults">No matching user were found</div>

  <div><a href="/admin/logout" class="btn btn-outline-secondary " style="margin-left: 1225px;">logout</a></div>
</div>

<script>
  function showAddRow() {
    document.getElementById('addForm').classList.remove('d-none');
  }

  function hideAddRow(){
    document.getElementById('addForm').classList.add('d-none')
  }

  function editEnable(userId){
     const row = document.getElementById('row-' + userId);  
  const inputs = row.querySelectorAll('input');  
  inputs.forEach(input => input.removeAttribute('readonly'));

  document.getElementById('saveBtn-' + userId).classList.remove('d-none');




    // const form = document.getElementById('form-'+userId)
    // const inputs = form.querySelectorAll('input')
    // inputs.forEach(input=>input.removeAttribute('readonly'))

    // document.getElementById('saveBtn-'+userId).classList.remove('d-none')
  }
//   function editEnable(userId){
//     const tr = document.querySelectorAll('tr')
//     const inputs = tr.querySelectorAll('td[contentEditable]')
//     inputs.forEach(input=>input.getAttribute('contentEditable')==='true')

//     document.getElementById('saveBtn-'+userId).classList.remove('d-none')
//   }
  
  function editSave(user){
    fetch(`/admin/edit/${user}`,{
        method:"PUT",
        headers:{
            'Content-Type':'application/json'
        },
        body:JSON.stringify({
            
        })
    })
  }


  function searchTable(){
    const searchInput =document.getElementById('searchInput').value
    const searchFilter =document.getElementById('searchFilter').value
    const tableBody =document.getElementById('tableBody') 
    const rows =document.getElementsByClassName('user-row') 
    const noResults =document.getElementById('noResults') 

    let visibleCount = 0 

    for(let i=0; i<rows.length;i++){
      const row = rows[i]
      const name = row.getAttribute('data-name').toLowerCase()
      const email = row.getAttribute('data-email').toLowerCase()
      const score = row.getAttribute('data-score').toLowerCase()

      let shouldShow = false

      if(searchInput === ''){
        shouldShow = true
      } 
      else if(searchFilter ==='all'){
        shouldShow = name.includes(searchInput) || email.includes(searchInput) ||score.includes(searchInput)
      }
      else if(searchFilter === 'name'){
        shouldShow = name.includes(searchInput)
      }
      else if(searchFilter === 'email'){
        shouldShow = email.includes(searchInput)
      }
      else if(searchFilter === 'score'){
        shouldShow = score.includes(searchInput)
      }

      if(shouldShow){
        row.style.display =''
        visibleCount++
      }else{
        row.style.display ='none'
      }

    }

    document.getElementById('resultCount').textContent = visibleCount

    if(visibleCount ===0 && searchInput!== ''){
      noResults.classList.remove('d-none')
    }else{
      noResults.classList.add('d-none')
    }
  }

  window.addEventListener('DOMContentLoaded',function(){
    const totalRows =document.getElementsByClassName('user-row').length
    document.getElementById('resultCount').textContent = totalRows
  })

  document.getElementById('searchInput').addEventListener('keydown',function(e){
    if(e.key ==='Escape'){
      this.value=''
      searchTable()
    }
  })


</script>
</body>
